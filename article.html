<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Article — Balkan Medical Journal</title>
  <meta name="description" content="Read this article from Balkan Medical Journal.">
  <meta property="og:title" content="Article — Balkan Medical Journal">
  <meta property="og:image" content="https://balkanmedicaljournal.org/images/cover/cover1.jpeg">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Article — Balkan Medical Journal">
  <meta name="twitter:description" content="Read this article from Balkan Medical Journal.">
  <meta name="twitter:image" content="https://balkanmedicaljournal.org/images/cover/cover1.jpeg">
  <link rel="icon" href="images/favicon.ico" type="image/x-icon">
  <link rel="icon" href="images/favicon-32x32.png" type="image/png" sizes="32x32">
  <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
  <link rel="stylesheet" href="css/style.css">
</head>
<body class="bg-white text-gray-900 font-sans">

  <!-- Skip to Content -->
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <!-- ══════════════════════════════════════════════════════════
       NAVIGATION
       ══════════════════════════════════════════════════════════ -->
  <nav class="bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm" aria-label="Main navigation">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-24">
        <!-- Logo -->
        <a href="index.html" class="flex items-center space-x-2 flex-shrink-0" aria-label="Balkan Medical Journal Home">
          <img src="images/logo.png" alt="Balkan Medical Journal" class="h-20 w-auto">
        </a>

        <!-- Desktop Nav -->
        <div class="hidden lg:flex items-center space-x-1">
          <a href="index.html" data-nav-page="index.html" class="px-3 py-2 text-base font-medium text-gray-700 hover:text-teal-700 rounded-lg hover:bg-gray-50 transition-colors">Home</a>

          <!-- About Dropdown -->
          <div class="relative group">
            <button data-dropdown-trigger class="px-3 py-2 text-base font-medium text-gray-700 hover:text-teal-700 rounded-lg hover:bg-gray-50 transition-colors inline-flex items-center">
              About
              <svg class="ml-1 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
            </button>
            <div class="nav-dropdown absolute left-0 mt-1 w-52 bg-white rounded-xl shadow-lg border border-gray-100 py-2 z-50">
              <a href="about.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-teal-700">About the Journal</a>
              <a href="editorial-board.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-teal-700">Editorial Board</a>
              <a href="journal-metrics.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-teal-700">Journal Metrics</a>
            </div>
          </div>

          <!-- Issues & Articles Dropdown -->
          <div class="relative group">
            <button data-dropdown-trigger class="px-3 py-2 text-base font-medium text-gray-700 hover:text-teal-700 rounded-lg hover:bg-gray-50 transition-colors inline-flex items-center">
              Issues &amp; Articles
              <svg class="ml-1 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
            </button>
            <div class="nav-dropdown absolute left-0 mt-1 w-52 bg-white rounded-xl shadow-lg border border-gray-100 py-2 z-50">
              <a href="current-issue.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-teal-700">Current Issue</a>
              <a href="articles-in-press.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-teal-700">Articles in Press</a>
              <a href="archive.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-teal-700">Archive</a>
            </div>
          </div>

          <a href="for-authors.html" data-nav-page="for-authors.html" class="px-3 py-2 text-base font-medium text-gray-700 hover:text-teal-700 rounded-lg hover:bg-gray-50 transition-colors">For Authors</a>
          <a href="for-reviewers.html" data-nav-page="for-reviewers.html" class="px-3 py-2 text-base font-medium text-gray-700 hover:text-teal-700 rounded-lg hover:bg-gray-50 transition-colors">For Reviewers</a>
          <a href="policies.html" data-nav-page="policies.html" class="px-3 py-2 text-base font-medium text-gray-700 hover:text-teal-700 rounded-lg hover:bg-gray-50 transition-colors">Policies</a>
          <a href="contact.html" data-nav-page="contact.html" class="px-3 py-2 text-base font-medium text-gray-700 hover:text-teal-700 rounded-lg hover:bg-gray-50 transition-colors">Contact</a>
        </div>

        <!-- Submit CTA + Mobile toggle -->
        <div class="flex items-center space-x-3">
          <button data-search-toggle class="p-2 text-gray-700 hover:text-teal-700 rounded-lg hover:bg-gray-50 transition-colors lg:hidden" aria-label="Search articles" title="Search (Ctrl+K)">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
          </button>
          <button data-search-toggle class="hidden lg:flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 bg-gray-50 border border-gray-200 rounded-lg hover:bg-gray-100 hover:text-teal-700 transition-colors shadow-sm whitespace-nowrap" aria-label="Search articles" title="Search (Ctrl+K)">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
            <span>Search</span>
          </button>
          <a href="https://balkanmedj.manuscriptmanager.net" target="_blank" rel="noopener" class="hidden sm:inline-flex items-center px-4 py-2 bg-red-700 text-white text-sm font-semibold rounded-lg hover:bg-red-800 transition-colors shadow-sm">
            Submit Manuscript
            <svg class="ml-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>
          </a>
          <button id="mobile-menu-btn" class="lg:hidden p-2 text-gray-700 hover:text-teal-700 rounded-lg hover:bg-gray-50" aria-expanded="false" aria-controls="mobile-menu" aria-label="Open menu">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
          </button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Mobile Menu Overlay -->
  <div id="mobile-menu-overlay" class="hidden fixed inset-0 bg-black/50 z-50" aria-hidden="true"></div>

  <!-- Mobile Menu Panel -->
  <div id="mobile-menu" class="fixed top-0 right-0 w-80 max-w-full h-full bg-white z-50 shadow-2xl transition-menu mobile-menu-enter overflow-y-auto" role="dialog" aria-modal="true" aria-label="Mobile navigation">
    <div class="flex items-center justify-between p-4 border-b border-gray-200">
      <span class="text-lg font-bold text-teal-700">Menu</span>
      <button id="mobile-menu-close" class="p-2 text-gray-500 hover:text-gray-700 rounded-lg" aria-label="Close menu">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
    </div>
    <div class="p-4 space-y-1">
      <button data-search-toggle id="mobile-search-trigger" class="w-full flex items-center px-4 py-3 text-gray-700 hover:bg-gray-50 hover:text-teal-700 rounded-lg font-medium">
        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
        Search Articles
      </button>
      <a href="index.html" class="block px-4 py-3 text-gray-700 hover:bg-gray-50 hover:text-teal-700 rounded-lg font-medium">Home</a>

      <!-- About Section -->
      <button data-mobile-dropdown="mobile-about" class="w-full flex items-center justify-between px-4 py-3 text-gray-700 hover:bg-gray-50 hover:text-teal-700 rounded-lg font-medium" aria-expanded="false">
        About
        <svg class="chevron-icon w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
      </button>
      <div id="mobile-about" class="hidden pl-4 space-y-1">
        <a href="about.html" class="block px-4 py-2 text-sm text-gray-600 hover:text-teal-700 hover:bg-gray-50 rounded-lg">About the Journal</a>
        <a href="editorial-board.html" class="block px-4 py-2 text-sm text-gray-600 hover:text-teal-700 hover:bg-gray-50 rounded-lg">Editorial Board</a>
        <a href="journal-metrics.html" class="block px-4 py-2 text-sm text-gray-600 hover:text-teal-700 hover:bg-gray-50 rounded-lg">Journal Metrics</a>
      </div>


      <!-- Issues Section -->
      <button data-mobile-dropdown="mobile-issues" class="w-full flex items-center justify-between px-4 py-3 text-gray-700 hover:bg-gray-50 hover:text-teal-700 rounded-lg font-medium" aria-expanded="false">
        Issues &amp; Articles
        <svg class="chevron-icon w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
      </button>
      <div id="mobile-issues" class="hidden pl-4 space-y-1">
        <a href="current-issue.html" class="block px-4 py-2 text-sm text-gray-600 hover:text-teal-700 hover:bg-gray-50 rounded-lg">Current Issue</a>
        <a href="articles-in-press.html" class="block px-4 py-2 text-sm text-gray-600 hover:text-teal-700 hover:bg-gray-50 rounded-lg">Articles in Press</a>
        <a href="archive.html" class="block px-4 py-2 text-sm text-gray-600 hover:text-teal-700 hover:bg-gray-50 rounded-lg">Archive</a>
      </div>

      <a href="for-authors.html" class="block px-4 py-3 text-gray-700 hover:bg-gray-50 hover:text-teal-700 rounded-lg font-medium">For Authors</a>
      <a href="for-reviewers.html" class="block px-4 py-3 text-gray-700 hover:bg-gray-50 hover:text-teal-700 rounded-lg font-medium">For Reviewers</a>
      <a href="policies.html" class="block px-4 py-3 text-gray-700 hover:bg-gray-50 hover:text-teal-700 rounded-lg font-medium">Policies</a>
      <a href="contact.html" class="block px-4 py-3 text-gray-700 hover:bg-gray-50 hover:text-teal-700 rounded-lg font-medium">Contact</a>
      <a href="news.html" class="block px-4 py-3 text-gray-700 hover:bg-gray-50 hover:text-teal-700 rounded-lg font-medium">News</a>
      <a href="forms.html" class="block px-4 py-3 text-gray-700 hover:bg-gray-50 hover:text-teal-700 rounded-lg font-medium">Forms</a>

      <div class="pt-4 border-t border-gray-200 mt-4">
        <a href="https://balkanmedj.manuscriptmanager.net" target="_blank" rel="noopener" class="flex items-center justify-center px-4 py-3 bg-red-700 text-white font-semibold rounded-lg hover:bg-red-800 transition-colors">
          Submit Manuscript
          <svg class="ml-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>
        </a>
      </div>
    </div>
  </div>

  <!-- Search Overlay -->
  <div id="search-overlay" class="hidden fixed inset-0 z-[60] bg-black/40 backdrop-blur-sm flex items-start justify-center pt-[12vh] sm:pt-[15vh] px-4" aria-hidden="true" role="dialog" aria-modal="true" aria-label="Search articles">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden ring-1 ring-gray-200">
      <div class="flex items-center gap-3 px-5 py-3 border-b border-gray-100">
        <svg class="w-5 h-5 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
        <input id="search-input" type="search" placeholder="Search articles, authors, keywords..." class="flex-1 text-base text-gray-900 placeholder-gray-400 bg-transparent border-0 p-0 focus:outline-none focus:ring-0" autocomplete="off">
        <button id="search-close" class="flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors" aria-label="Close search">
          <kbd class="hidden sm:inline-block px-2 py-1 text-xs font-medium text-gray-400 bg-gray-100 rounded-md border border-gray-200">ESC</kbd>
          <svg class="sm:hidden w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div id="search-results" class="max-h-[60vh] overflow-y-auto px-3 py-3">
        <p class="text-sm text-gray-400 text-center py-8">Search articles, authors, keywords, news, and pages...<br><span class="text-xs mt-1 inline-block">Type at least 2 characters</span></p>
      </div>
      <div class="flex items-center justify-between px-5 py-2.5 border-t border-gray-100 bg-gray-50/80 text-xs text-gray-400">
        <div class="flex items-center gap-3">
          <span class="inline-flex items-center gap-1"><kbd class="px-1.5 py-0.5 bg-white rounded border border-gray-200 text-[10px] font-medium">&uarr;</kbd><kbd class="px-1.5 py-0.5 bg-white rounded border border-gray-200 text-[10px] font-medium">&darr;</kbd> navigate</span>
          <span class="inline-flex items-center gap-1"><kbd class="px-1.5 py-0.5 bg-white rounded border border-gray-200 text-[10px] font-medium">&crarr;</kbd> open</span>
        </div>
        <span class="inline-flex items-center gap-1"><kbd class="px-1.5 py-0.5 bg-white rounded border border-gray-200 text-[10px] font-medium">esc</kbd> close</span>
      </div>
    </div>
  </div>


  <main id="main-content">
    <!-- Breadcrumb -->
    <div class="bg-gray-50 border-b border-gray-200">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
        <nav aria-label="Breadcrumb">
          <ol id="article-breadcrumb" class="flex items-center space-x-2 text-sm text-gray-500">
            <li><a href="index.html" class="hover:text-teal-700">Home</a></li>
            <li><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg></li>
            <li><a id="breadcrumb-section-link" href="current-issue.html" class="hover:text-teal-700">Current Issue</a></li>
            <li><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg></li>
            <li id="breadcrumb-title" aria-current="page" class="text-gray-900 font-medium truncate max-w-xs">Article</li>
          </ol>
        </nav>
      </div>
    </div>

    <!-- Article Content (populated by JS) -->
    <div id="article-content" class="py-10">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center py-20 text-gray-400">
          <div class="spinner mx-auto mb-4" style="border-color: rgba(15,118,110,0.2); border-top-color: #0F766E; width:40px; height:40px; border-width:3px;"></div>
          <p>Loading article...</p>
        </div>
      </div>
    </div>

    <!-- Article Not Found (hidden by default) -->
    <div id="article-not-found" class="hidden py-20">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <svg class="w-16 h-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
        <h2 class="text-2xl font-bold text-gray-900 mb-2">Article Not Found</h2>
        <p class="text-gray-500 mb-6">The article you're looking for doesn't exist or has been moved.</p>
        <a href="current-issue.html" class="inline-flex items-center px-5 py-3 bg-teal-700 text-white font-semibold rounded-lg hover:bg-teal-800 transition-colors">Browse Current Issue</a>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-teal-900 text-white" aria-label="Site footer">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
        <div>
          <div class="flex items-center space-x-2 mb-4">
            <div class="w-12 h-12 rounded-lg flex items-center justify-center overflow-hidden"><img src="images/logo.png" alt="Balkan Medical Journal" class="h-12 w-12 object-contain"></div>
            <div class="font-bold text-lg">Balkan Medical Journal</div>
          </div>
          <p class="text-teal-300 text-sm leading-relaxed">Published by Trakya University, Edirne, Türkiye.<br>E-ISSN: 2146-3131</p>
        </div>
        <div><h3 class="font-semibold text-lg mb-4">Quick Links</h3><ul class="space-y-2 text-teal-300 text-sm"><li><a href="current-issue.html" class="hover:text-white transition-colors">Current Issue</a></li><li><a href="archive.html" class="hover:text-white transition-colors">Archive</a></li><li><a href="for-authors.html" class="hover:text-white transition-colors">For Authors</a></li></ul></div>
        <div><h3 class="font-semibold text-lg mb-4">About</h3><ul class="space-y-2 text-teal-300 text-sm"><li><a href="about.html" class="hover:text-white transition-colors">About the Journal</a></li><li><a href="editorial-board.html" class="hover:text-white transition-colors">Editorial Board</a></li><li><a href="journal-metrics.html" class="hover:text-white transition-colors">Journal Metrics</a></li><li><a href="policies.html" class="hover:text-white transition-colors">Policies</a></li></ul></div>
        <div><h3 class="font-semibold text-lg mb-4">Contact</h3><div class="text-teal-300 text-sm space-y-2"><p>Trakya University Faculty of Medicine<br>Edirne, Türkiye</p><p><a href="mailto:info@balkanmedicaljournal.org" class="hover:text-white transition-colors">info@balkanmedicaljournal.org</a></p><div class="flex items-center gap-4 mt-3"><a href="https://www.instagram.com/balkanmedj/" target="_blank" rel="noopener" aria-label="Instagram" class="text-teal-300 hover:text-white transition-colors"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/></svg></a><a href="https://x.com/balkanmedj" target="_blank" rel="noopener" aria-label="X (Twitter)" class="text-teal-300 hover:text-white transition-colors"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a><a href="https://www.linkedin.com/company/balkan-med-j/" target="_blank" rel="noopener" aria-label="LinkedIn" class="text-teal-300 hover:text-white transition-colors"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a></div></div></div>
      </div>
      <div class="border-t border-teal-800 mt-10 pt-8 text-center text-teal-400 text-sm"><p>&copy; 2026 Balkan Medical Journal. Licensed under CC BY-NC-ND 4.0</p></div>
    </div>
  </footer>

  <button id="scroll-top" class="scroll-top-btn fixed bottom-6 right-6 w-12 h-12 bg-teal-700 text-white rounded-full shadow-lg hover:bg-teal-800 transition-colors hidden md:flex items-center justify-center z-40 no-print" aria-label="Scroll to top">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/></svg>
  </button>

  <script src="js/data/articles.js"></script>
  <script src="js/data/articles-in-press.js"></script>
  <script src="js/data-loader.js"></script>
  <script src="js/data/news.js"></script>
  <script src="js/main.js"></script>
  <script src="js/search.js"></script>
  <script src="js/citation.js"></script>
  <script>
    (function () {
      var params = new URLSearchParams(window.location.search);
      var id = parseInt(params.get('id'));
      var contentEl = document.getElementById('article-content');
      var notFoundEl = document.getElementById('article-not-found');
      var breadcrumbTitle = document.getElementById('breadcrumb-title');
      var breadcrumbSectionLink = document.getElementById('breadcrumb-section-link');
      var sourceContext = String(params.get('source') || '').toLowerCase();
      var contextYear = params.get('year');
      var contextLabel = params.get('label');
      var contextSourceId = params.get('sourceId');
      var contextVolume = params.get('volume');
      var contextIssue = params.get('issue');

      if (!sourceContext && (contextYear || contextLabel || contextSourceId)) {
        sourceContext = 'archive';
      }
      if (sourceContext === 'articles-in-press' || sourceContext === 'press') {
        sourceContext = 'aip';
      }

      if (!id) {
        contentEl.classList.add('hidden');
        notFoundEl.classList.remove('hidden');
        return;
      }

      var article = null;
      if (Array.isArray(window.ARTICLES)) {
        article = window.ARTICLES.find(function (a) { return a.id === id; }) || null;
      }

      // Fallback for AIP entries that are not yet present in local ARTICLES index.
      if (!article && sourceContext === 'aip' && Array.isArray(window.ARTICLES_IN_PRESS)) {
        var aipArticle = window.ARTICLES_IN_PRESS.find(function (a) { return Number(a.id) === id; });
        if (aipArticle) {
          article = {
            id: Number(aipArticle.id),
            type: aipArticle.type || 'Article',
            title: aipArticle.title || '',
            authors: Array.isArray(aipArticle.authors) ? aipArticle.authors : [],
            abstract: aipArticle.abstract || '',
            abstractHtml: aipArticle.abstractHtml || '',
            previewText: aipArticle.previewText || aipArticle.abstract || '',
            keywords: Array.isArray(aipArticle.keywords) ? aipArticle.keywords : [],
            doi: aipArticle.doi || '',
            received: '',
            accepted: '',
            published: aipArticle.published || new Date().toISOString().slice(0, 10),
            volume: aipArticle.volume || '',
            issue: aipArticle.issue || '',
            pages: aipArticle.pages || '',
            views: Number(aipArticle.views || 0),
            downloads: Number(aipArticle.downloads || 0),
            citations: 0,
            featured: false,
            imageCorner: false,
            hasFullText: Boolean(aipArticle.hasFullText),
            sourceIssueId: '46',
            sourceArticleId: String(aipArticle.id),
            sourceAbstractUrl: aipArticle.sourceAbstractUrl || '',
            sourceTextUrl: aipArticle.sourceTextUrl || '',
            sourcePdfUrl: aipArticle.sourcePdfUrl || '',
            localPdfUrl: '',
            pdfUrl: aipArticle.sourcePdfUrl || '',
            aheadOfPrint: true
          };
        }
      }

      if (!article) {
        contentEl.classList.add('hidden');
        notFoundEl.classList.remove('hidden');
        return;
      }

      function buildArticleUrl(articleId) {
        var qp = new URLSearchParams();
        qp.set('id', String(articleId));
        if (sourceContext === 'archive') {
          qp.set('source', 'archive');
          if (contextYear) qp.set('year', contextYear);
          if (contextLabel) qp.set('label', contextLabel);
          if (contextSourceId) qp.set('sourceId', contextSourceId);
          if (contextVolume) qp.set('volume', contextVolume);
          if (contextIssue) qp.set('issue', contextIssue);
        } else if (sourceContext === 'aip') {
          qp.set('source', 'aip');
        }
        return 'article.html?' + qp.toString();
      }

      var hasFullText = !!article.hasFullText;
      var fullTextLoaded = false;
      var noAbstractTypes = ['Editorial', 'Clinical Image', 'Scientific Letter', 'Letter to the Editor'];
      var isNoAbstract = noAbstractTypes.indexOf(article.type) !== -1;
      var isCoverPage = article.type === 'Cover Page';
      var tocAllowedTypes = ['Invited Review', 'Original Article', 'Brief Report'];
      var canShowTocCard = hasFullText && tocAllowedTypes.indexOf(article.type) !== -1;
      var pdfHref = article.pdfUrl || article.localPdfUrl || article.sourcePdfUrl || '';

      function escapeAttr(value) {
        return String(value || '')
          .replace(/&/g, '&amp;')
          .replace(/"/g, '&quot;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;');
      }

      function normalizeDoi(value) {
        var doi = String(value || '').trim();
        if (!doi) return '';
        doi = doi.replace(/^https?:\/\/(dx\.)?doi\.org\//i, '');
        doi = doi.replace(/^doi:\s*/i, '');
        return doi.trim();
      }

      function loadScriptOnce(id, src) {
        return new Promise(function (resolve, reject) {
          var existing = document.getElementById(id);
          if (existing) {
            if (existing.getAttribute('data-loaded') === 'true') resolve();
            else existing.addEventListener('load', function () { resolve(); }, { once: true });
            return;
          }
          var script = document.createElement('script');
          script.id = id;
          script.src = src;
          script.async = true;
          script.onload = function () {
            script.setAttribute('data-loaded', 'true');
            resolve();
          };
          script.onerror = reject;
          document.head.appendChild(script);
        });
      }

      function toAbsoluteOpenAlexUrl(idOrUrl) {
        var value = String(idOrUrl || '').trim();
        if (!value) return '';
        if (/^https?:\/\//i.test(value)) return value;
        var match = value.match(/W\d+/i);
        return match ? ('https://openalex.org/' + match[0].toUpperCase()) : '';
      }

      function extractOpenAlexWorkId(idOrUrl) {
        var match = String(idOrUrl || '').match(/W\d+/i);
        return match ? match[0].toUpperCase() : '';
      }

      function aggregateTopLabels(labels, limit) {
        var map = {};
        (labels || []).forEach(function (label) {
          var key = String(label || '').trim();
          if (!key) return;
          map[key] = (map[key] || 0) + 1;
        });
        return Object.keys(map)
          .map(function (label) { return { label: label, count: map[label] }; })
          .sort(function (a, b) {
            if (b.count !== a.count) return b.count - a.count;
            return a.label.localeCompare(b.label);
          })
          .slice(0, limit || 4);
      }

      function renderCountBadges(container, items, emptyText) {
        if (!container) return;
        container.innerHTML = '';
        if (!items || !items.length) {
          var empty = document.createElement('span');
          empty.className = 'text-sm text-gray-500';
          empty.textContent = emptyText;
          container.appendChild(empty);
          return;
        }
        items.forEach(function (item) {
          var chip = document.createElement('span');
          chip.className = 'inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-white border border-gray-200 text-xs leading-5 text-gray-700';
          chip.textContent = item.label + ' (' + item.count + ')';
          container.appendChild(chip);
        });
      }

      function renderLabelBadges(container, labels, emptyText) {
        if (!container) return;
        container.innerHTML = '';
        if (!labels || !labels.length) {
          var empty = document.createElement('span');
          empty.className = 'text-sm text-gray-500';
          empty.textContent = emptyText;
          container.appendChild(empty);
          return;
        }
        labels.forEach(function (label) {
          var chip = document.createElement('span');
          chip.className = 'inline-flex items-center px-2.5 py-1 rounded-full bg-white border border-gray-200 text-xs leading-5 text-gray-700';
          chip.textContent = label;
          container.appendChild(chip);
        });
      }

      function renderTopCitingPapers(container, works) {
        if (!container) return;
        container.innerHTML = '';
        if (!works || !works.length) {
          var empty = document.createElement('p');
          empty.className = 'text-sm text-gray-500';
          empty.textContent = 'No citing paper data available.';
          container.appendChild(empty);
          return;
        }

        var sorted = works.slice().sort(function (a, b) {
          var bc = Number(b && b.cited_by_count || 0);
          var ac = Number(a && a.cited_by_count || 0);
          if (bc !== ac) return bc - ac;
          return Number(b && b.publication_year || 0) - Number(a && a.publication_year || 0);
        }).slice(0, 3);

        sorted.forEach(function (work) {
          var href = toAbsoluteOpenAlexUrl(work && work.id);
          var row = document.createElement(href ? 'a' : 'div');
          row.className = 'block p-3 rounded-lg bg-white border border-gray-200 hover:border-teal-200 hover:bg-teal-50/40 transition-colors';
          if (href) {
            row.href = href;
            row.target = '_blank';
            row.rel = 'noopener';
          }

          var title = document.createElement('div');
          title.className = 'text-sm font-medium text-gray-800 leading-snug';
          title.textContent = String(work && work.display_name || 'Untitled citing work');

          var year = work && work.publication_year ? String(work.publication_year) : 'n.d.';
          var citedBy = Number(work && work.cited_by_count || 0).toLocaleString();
          var meta = document.createElement('div');
          meta.className = 'text-xs text-gray-500 mt-1';
          meta.textContent = year + ' • Cited by ' + citedBy;

          row.appendChild(title);
          row.appendChild(meta);
          container.appendChild(row);
        });
      }

      function renderCitationTrend(countsByYear) {
        var barsEl = document.getElementById('citation-trend-bars');
        var rangeEl = document.getElementById('citation-trend-range');
        if (!barsEl) return;
        barsEl.innerHTML = '';

        var currentYear = new Date().getFullYear();
        var years = [];
        for (var y = currentYear - 5; y <= currentYear; y++) years.push(y);
        if (rangeEl) rangeEl.textContent = years[0] + '-' + years[years.length - 1];

        var map = {};
        (countsByYear || []).forEach(function (item) {
          if (!item || typeof item.year !== 'number') return;
          map[item.year] = Number(item.cited_by_count || 0);
        });

        var values = years.map(function (year) { return map[year] || 0; });
        var max = Math.max.apply(null, values.concat([1]));

        years.forEach(function (year, index) {
          var value = values[index];
          var col = document.createElement('div');
          col.className = 'flex-1 h-full rounded-sm bg-teal-100/70 relative overflow-hidden';
          col.title = year + ': ' + value + ' citations';

          var fill = document.createElement('div');
          fill.className = 'absolute inset-x-0 bottom-0 bg-teal-700';
          fill.style.height = (value <= 0 ? 4 : Math.max(8, Math.round((value / max) * 100))) + '%';

          col.appendChild(fill);
          barsEl.appendChild(col);
        });
      }

      function fetchOpenAlexWorkByDoi(doi) {
        var url = 'https://api.openalex.org/works?filter=doi:' + encodeURIComponent(doi) + '&per-page=1&select=id,cited_by_count,counts_by_year,concepts';
        return fetch(url).then(function (res) {
          if (!res.ok) throw new Error('OpenAlex response ' + res.status);
          return res.json();
        }).then(function (json) {
          var work = json && json.results && json.results[0];
          if (!work) throw new Error('OpenAlex work not found');
          return work;
        });
      }

      function fetchTopCitingWorks(openAlexWorkId) {
        if (!openAlexWorkId) return Promise.resolve([]);
        var url = 'https://api.openalex.org/works?filter=cites:' + encodeURIComponent(openAlexWorkId) + '&per-page=25&sort=cited_by_count:desc&select=id,display_name,publication_year,primary_location,primary_topic,cited_by_count';
        return fetch(url).then(function (res) {
          if (!res.ok) throw new Error('OpenAlex citing-works response ' + res.status);
          return res.json();
        }).then(function (json) {
          return json && Array.isArray(json.results) ? json.results : [];
        });
      }

      var openAlexWorkPromise = null;
      function getOpenAlexWork(doi) {
        if (!doi) return Promise.reject(new Error('Missing DOI'));
        if (!openAlexWorkPromise) {
          openAlexWorkPromise = fetchOpenAlexWorkByDoi(doi);
        }
        return openAlexWorkPromise;
      }

      function setCitationMetric(count, sourceText) {
        var countEl = document.getElementById('metric-citations');
        var sourceEl = document.getElementById('metric-citations-source');
        if (countEl) {
          var numeric = Number(count);
          countEl.textContent = isNaN(numeric) ? '0' : numeric.toLocaleString();
        }
        if (sourceEl) sourceEl.textContent = sourceText || '';
      }

      function fetchOpenAlexCitationCount(doi) {
        return getOpenAlexWork(doi).then(function (work) {
          var count = work && work.cited_by_count;
          if (typeof count === 'number') return count;
          throw new Error('No OpenAlex citation count');
        });
      }

      function fetchCrossrefCitationCount(doi) {
        var url = 'https://api.crossref.org/works/' + encodeURIComponent(doi);
        return fetch(url).then(function (res) {
          if (!res.ok) throw new Error('Crossref response ' + res.status);
          return res.json();
        }).then(function (json) {
          var count = json && json.message && json.message['is-referenced-by-count'];
          if (typeof count === 'number') return count;
          throw new Error('No Crossref citation count');
        });
      }

      function syncCitationMetric() {
        if (isCoverPage) return;
        var localCount = Number(article.citations || 0);
        var doi = normalizeDoi(article.doi);
        setCitationMetric(localCount, doi ? 'Source: OpenAlex' : 'Source: local dataset');

        if (!doi || typeof fetch !== 'function') return;

        fetchOpenAlexCitationCount(doi).then(function (count) {
          article.citations = count;
          setCitationMetric(count, 'Source: OpenAlex');
        }).catch(function () {
          setCitationMetric(localCount, 'Source: OpenAlex unavailable');
        });
      }

      function initCitationIntelligence() {
        if (isCoverPage) return;

        var loadingEl = document.getElementById('citation-intel-loading');
        var contentWrap = document.getElementById('citation-intel-content');
        var emptyEl = document.getElementById('citation-intel-empty');
        var toggleBtn = document.getElementById('citation-intel-toggle');
        var toggleText = document.getElementById('citation-intel-toggle-text');
        var toggleIcon = document.getElementById('citation-intel-toggle-icon');
        var detailsWrap = document.getElementById('citation-intel-details');
        var openAlexLink = document.getElementById('citation-intel-openalex');
        var journalsEl = document.getElementById('citation-intel-journals');
        var fieldsEl = document.getElementById('citation-intel-fields');
        var papersEl = document.getElementById('citation-intel-papers');
        if (!loadingEl || !contentWrap || !emptyEl) return;
        var detailsExpanded = false;

        function setDetailsExpanded(expanded) {
          detailsExpanded = !!expanded;
          if (detailsWrap) {
            detailsWrap.classList.toggle('hidden', !detailsExpanded);
          }
          if (toggleBtn) toggleBtn.setAttribute('aria-expanded', detailsExpanded ? 'true' : 'false');
          if (toggleText) toggleText.textContent = detailsExpanded ? 'Hide details' : 'Show details';
          if (toggleIcon) toggleIcon.style.transform = detailsExpanded ? 'rotate(180deg)' : 'rotate(0deg)';
        }

        if (toggleBtn) {
          toggleBtn.addEventListener('click', function () {
            setDetailsExpanded(!detailsExpanded);
          });
          setDetailsExpanded(false);
        }

        function showLoading(text) {
          loadingEl.textContent = text || 'Loading citation intelligence...';
          loadingEl.classList.remove('hidden');
          contentWrap.classList.add('hidden');
          emptyEl.classList.add('hidden');
          if (toggleBtn) toggleBtn.classList.add('hidden');
          if (detailsWrap) detailsWrap.classList.add('hidden');
        }

        function showEmpty(text) {
          emptyEl.textContent = text;
          emptyEl.classList.remove('hidden');
          loadingEl.classList.add('hidden');
          contentWrap.classList.add('hidden');
          if (toggleBtn) toggleBtn.classList.add('hidden');
          if (detailsWrap) detailsWrap.classList.add('hidden');
        }

        function showContent() {
          contentWrap.classList.remove('hidden');
          loadingEl.classList.add('hidden');
          emptyEl.classList.add('hidden');
          if (toggleBtn) toggleBtn.classList.remove('hidden');
          setDetailsExpanded(false);
        }

        var doi = normalizeDoi(article.doi);
        if (!doi) {
          showEmpty('Citation intelligence requires DOI.');
          return;
        }

        showLoading('Loading citation intelligence...');

        getOpenAlexWork(doi).then(function (work) {
          var total = Number(work && work.cited_by_count || 0);
          var noCitingFieldsMessage = 'No citing field data available.';
          setCitationMetric(total, 'Source: OpenAlex');
          renderCitationTrend(work && work.counts_by_year || []);

          if (openAlexLink) {
            var absoluteOpenAlexUrl = toAbsoluteOpenAlexUrl(work && work.id);
            openAlexLink.href = absoluteOpenAlexUrl || ('https://openalex.org/works?filter=doi:' + encodeURIComponent(doi));
          }

          var openAlexId = extractOpenAlexWorkId(work && work.id);
          if (!openAlexId) {
            renderCountBadges(journalsEl, [], 'No journal data available.');
            if (total <= 0) {
              renderCountBadges(fieldsEl, [], noCitingFieldsMessage);
            } else {
              var fallbackTopics = (work && Array.isArray(work.concepts) ? work.concepts : [])
                .slice()
                .sort(function (a, b) { return Number(b && b.score || 0) - Number(a && a.score || 0); })
                .slice(0, 4)
                .map(function (c) { return c && c.display_name; })
                .filter(Boolean);
              renderLabelBadges(fieldsEl, fallbackTopics, 'No field data available.');
            }
            renderTopCitingPapers(papersEl, []);
            showContent();
            return null;
          }

          return fetchTopCitingWorks(openAlexId).then(function (citingWorks) {
            var journals = aggregateTopLabels(citingWorks.map(function (w) {
              return w && w.primary_location && w.primary_location.source && w.primary_location.source.display_name;
            }), 4);

            var fields = aggregateTopLabels(citingWorks.map(function (w) {
              return w && w.primary_topic && w.primary_topic.display_name;
            }), 4);

            renderCountBadges(journalsEl, journals, 'No journal data available.');
            if (total <= 0) {
              renderCountBadges(fieldsEl, [], noCitingFieldsMessage);
            } else if (fields.length > 0) {
              renderCountBadges(fieldsEl, fields, 'No field data available.');
            } else {
              var topics = (work && Array.isArray(work.concepts) ? work.concepts : [])
                .slice()
                .sort(function (a, b) { return Number(b && b.score || 0) - Number(a && a.score || 0); })
                .slice(0, 4)
                .map(function (c) { return c && c.display_name; })
                .filter(Boolean);
              renderLabelBadges(fieldsEl, topics, 'No field data available.');
            }

            renderTopCitingPapers(papersEl, citingWorks);
            showContent();
            return null;
          }).catch(function () {
            renderCountBadges(journalsEl, [], 'No journal data available.');
            if (total <= 0) {
              renderCountBadges(fieldsEl, [], noCitingFieldsMessage);
            } else {
              var fallbackTopics = (work && Array.isArray(work.concepts) ? work.concepts : [])
                .slice()
                .sort(function (a, b) { return Number(b && b.score || 0) - Number(a && a.score || 0); })
                .slice(0, 4)
                .map(function (c) { return c && c.display_name; })
                .filter(Boolean);
              renderLabelBadges(fieldsEl, fallbackTopics, 'No field data available.');
            }
            renderTopCitingPapers(papersEl, []);
            showContent();
            return null;
          });
        }).catch(function () {
          showEmpty('Citation intelligence is currently unavailable for this DOI.');
        });
      }

      function initAttentionWidgets() {
        if (isCoverPage) return;

        var attentionGrid = document.getElementById('attention-metrics-grid');
        var altmetricWrap = document.getElementById('altmetric-wrapper');
        var plumxWrap = document.getElementById('plumx-wrapper');
        var emptyNote = document.getElementById('attention-unavailable');
        var doi = normalizeDoi(article.doi);

        function syncAttentionLayout() {
          if (!attentionGrid) return;
          var altHidden = !altmetricWrap || altmetricWrap.classList.contains('hidden');
          var plumHidden = !plumxWrap || plumxWrap.classList.contains('hidden');
          var oneVisible = altHidden !== plumHidden;
          var noneVisible = altHidden && plumHidden;
          attentionGrid.classList.toggle('grid-cols-1', oneVisible);
          attentionGrid.classList.toggle('grid-cols-2', !oneVisible);
          attentionGrid.classList.toggle('hidden', noneVisible);
        }

        if (!doi) {
          if (altmetricWrap) altmetricWrap.classList.add('hidden');
          if (plumxWrap) plumxWrap.classList.add('hidden');
          syncAttentionLayout();
          if (emptyNote) {
            emptyNote.classList.remove('hidden');
            emptyNote.textContent = 'Attention metrics are unavailable because DOI is missing.';
          }
          return;
        }

        var altBadge = document.getElementById('altmetric-badge');
        if (altBadge) altBadge.setAttribute('data-doi', doi);

        var plumxBadge = document.getElementById('plumx-badge');
        if (plumxBadge) plumxBadge.href = 'https://plu.mx/plum/a/?doi=' + encodeURIComponent(doi);

        function maybeShowAttentionUnavailable() {
          var altHidden = !altmetricWrap || altmetricWrap.classList.contains('hidden');
          var plumHidden = !plumxWrap || plumxWrap.classList.contains('hidden');
          syncAttentionLayout();
          if (altHidden && plumHidden && emptyNote) {
            emptyNote.classList.remove('hidden');
            emptyNote.textContent = 'Attention metrics are currently unavailable for this DOI.';
          }
        }

        loadScriptOnce('altmetric-embed-script', 'https://embed.altmetric.com/assets/embed.js')
          .then(function () {
            if (typeof window._altmetric_embed_init === 'function') {
              window._altmetric_embed_init();
            }
          })
          .catch(function () {
            if (altmetricWrap) altmetricWrap.classList.add('hidden');
            maybeShowAttentionUnavailable();
          });

        loadScriptOnce('plumx-widget-script', 'https://cdn.plu.mx/widget-popup.js')
          .catch(function () {
            if (plumxWrap) plumxWrap.classList.add('hidden');
            maybeShowAttentionUnavailable();
          });
      }

      function stripDuplicateAbstractLabel(rawHtml) {
        if (!rawHtml) return '';
        var root = document.createElement('div');
        root.innerHTML = String(rawHtml);

        function removeLeadingAbstract(container) {
          if (!container || !container.firstElementChild) return;
          var first = container.firstElementChild;
          while (first && !first.textContent.trim() && first.nextElementSibling) {
            first = first.nextElementSibling;
          }
          if (!first) return;

          var label = first.textContent.replace(/\s+/g, ' ').trim().toLowerCase().replace(/[:\-]+$/, '');
          if (label === 'abstract') {
            first.remove();
          }
        }

        removeLeadingAbstract(root);
        if (root.children.length === 1) {
          removeLeadingAbstract(root.firstElementChild);
        }
        return root.innerHTML;
      }

      function stripAbstractFromFullText(rawHtml) {
        if (!rawHtml) return '';
        var root = document.createElement('div');
        root.innerHTML = String(rawHtml);

        function normalizeLabel(value) {
          return String(value || '')
            .replace(/\s+/g, ' ')
            .trim()
            .toLowerCase()
            .replace(/[:\-]+$/, '');
        }

        function hasIntroMarker(node) {
          if (!node) return false;
          if (node.querySelector('a[name="introduction"], a[name="methods"], a[name="materials-methods"], a[name="conclusion"], a[name="reference"]')) {
            return true;
          }
          var h = node.querySelector('h1, h2, h3, h4, h5, h6');
          if (!h) return false;
          var label = normalizeLabel(h.textContent);
          return label === 'introduction' || label === 'methods' || label === 'materials and methods' || label === 'conclusion' || label === 'references';
        }

        function removeSummarySection(anchor) {
          if (!anchor) return false;
          var block = anchor;
          while (block && block.parentElement && block.parentElement !== root) {
            if (block.nextElementSibling && hasIntroMarker(block.nextElementSibling)) {
              block.remove();
              return true;
            }
            block = block.parentElement;
          }
          return false;
        }

        var summaryAnchor = root.querySelector('a[name="summary_en"], a[name="summary"], a[name="abstract"]');
        removeSummarySection(summaryAnchor);

        var firstHeading = root.querySelector('h1, h2, h3, h4, h5, h6');
        if (firstHeading && normalizeLabel(firstHeading.textContent) === 'abstract') {
          var cursor = firstHeading;
          while (cursor) {
            var next = cursor.nextElementSibling;
            cursor.remove();
            if (!next) break;
            if (/^H[1-6]$/.test(next.tagName) && normalizeLabel(next.textContent) !== 'abstract') {
              break;
            }
            cursor = next;
          }
        }

        // Source full text often inserts an <hr> right before "Introduction".
        // Remove that divider to avoid an extra horizontal line at the top.
        var dividers = root.querySelectorAll('hr');
        Array.prototype.forEach.call(dividers, function (hr) {
          var next = hr.nextElementSibling;
          while (next && next.tagName === 'A' && !next.textContent.trim()) {
            next = next.nextElementSibling;
          }
          if (next && /^H[1-6]$/.test(next.tagName) && normalizeLabel(next.textContent) === 'introduction') {
            hr.remove();
          }
        });

        // Tighten top spacing for the first visible heading in full text.
        var firstContentHeading = root.querySelector('h1, h2, h3, h4, h5, h6');
        if (firstContentHeading) {
          var prev = firstContentHeading.previousElementSibling;
          while (prev) {
            var keep = true;
            if (prev.tagName === 'BR') keep = false;
            if (prev.tagName === 'A' && !prev.textContent.trim() && !prev.getAttribute('href')) keep = false;
            if (prev.tagName === 'P' && !prev.textContent.trim()) keep = false;
            if (keep) break;
            var older = prev.previousElementSibling;
            prev.remove();
            prev = older;
          }
          firstContentHeading.style.marginTop = '0';

          var headingParent = firstContentHeading.parentElement;
          if (headingParent && headingParent.style && headingParent.style.minHeight) {
            headingParent.style.minHeight = '';
          }
        }

        return root.innerHTML;
      }

      function getStickyHeaderOffset() {
        var nav = document.querySelector('nav[aria-label="Main navigation"]');
        var navHeight = nav ? nav.getBoundingClientRect().height : 0;
        return Math.max(96, Math.round(navHeight + 16));
      }

      function scrollToArticleTarget(node) {
        if (!node) return;
        var top = node.getBoundingClientRect().top + window.pageYOffset - getStickyHeaderOffset();
        window.scrollTo({ top: Math.max(0, top), behavior: 'smooth' });
      }

      // Update page title
      document.title = article.title + ' — Balkan Medical Journal';
      if (breadcrumbTitle) breadcrumbTitle.textContent = article.title;
      if (breadcrumbSectionLink) {
        if (sourceContext === 'archive') {
          breadcrumbSectionLink.textContent = 'Archive';
          breadcrumbSectionLink.href = 'archive.html';
        } else if (sourceContext === 'aip') {
          breadcrumbSectionLink.textContent = 'Articles in Press';
          breadcrumbSectionLink.href = 'articles-in-press.html';
        } else {
          breadcrumbSectionLink.textContent = 'Current Issue';
          breadcrumbSectionLink.href = 'current-issue.html';
        }
      }

      // Update meta description
      var metaDesc = document.querySelector('meta[name="description"]');
      if (metaDesc && article.abstract) {
        metaDesc.setAttribute('content', article.abstract.substring(0, 200));
      }

      // Inject Google Scholar citation meta tags
      (function injectCitationMeta() {
        function addMeta(name, content) {
          if (!content) return;
          var meta = document.createElement('meta');
          meta.setAttribute('name', name);
          meta.setAttribute('content', content);
          document.head.appendChild(meta);
        }

        addMeta('citation_title', article.title);
        article.authors.forEach(function (a) { addMeta('citation_author', a.name); });
        addMeta('citation_doi', article.doi);
        addMeta('citation_journal_title', 'Balkan Medical Journal');
        addMeta('citation_journal_abbrev', 'Balkan Med J');
        addMeta('citation_volume', String(article.volume));
        addMeta('citation_issue', String(article.issue));

        if (article.pages) {
          var pp = article.pages.split('-');
          addMeta('citation_firstpage', pp[0]);
          if (pp[1]) addMeta('citation_lastpage', pp[1]);
        }

        if (article.published) {
          var d = new Date(article.published);
          addMeta('citation_publication_date', d.getFullYear() + '/' + String(d.getMonth() + 1).padStart(2, '0') + '/' + String(d.getDate()).padStart(2, '0'));
          addMeta('citation_online_date', d.getFullYear() + '/' + String(d.getMonth() + 1).padStart(2, '0') + '/' + String(d.getDate()).padStart(2, '0'));
        }

        addMeta('citation_issn', '2146-3131');
        addMeta('citation_language', 'en');
        addMeta('citation_publisher', 'Trakya University');
        addMeta('citation_fulltext_html_url', window.location.href);
      })();

      // Inject JSON-LD ScholarlyArticle structured data
      (function injectJsonLd() {
        var schema = {
          '@context': 'https://schema.org',
          '@type': 'ScholarlyArticle',
          'headline': article.title,
          'author': article.authors.map(function (a) {
            var person = { '@type': 'Person', 'name': a.name };
            if (a.orcid) person.identifier = 'https://orcid.org/' + a.orcid;
            if (a.affiliation) person.affiliation = { '@type': 'Organization', 'name': a.affiliation };
            return person;
          }),
          'datePublished': article.published || '',
          'dateReceived': article.received || '',
          'dateAccepted': article.accepted || '',
          'description': article.abstract || '',
          'keywords': (article.keywords || []).join(', '),
          'pageStart': article.pages ? article.pages.split('-')[0] : '',
          'pageEnd': article.pages && article.pages.split('-')[1] ? article.pages.split('-')[1] : '',
          'publisher': { '@type': 'Organization', 'name': 'Trakya University' },
          'isPartOf': {
            '@type': 'PublicationVolume',
            'volumeNumber': String(article.volume),
            'isPartOf': {
              '@type': 'Periodical',
              'name': 'Balkan Medical Journal',
              'issn': '2146-3131',
              'publisher': { '@type': 'Organization', 'name': 'Trakya University' }
            }
          },
          'url': window.location.href,
          'identifier': { '@type': 'PropertyValue', 'propertyID': 'DOI', 'value': article.doi }
        };
        var script = document.createElement('script');
        script.type = 'application/ld+json';
        script.textContent = JSON.stringify(schema);
        document.head.appendChild(script);
      })();

      var typeColor = article.type === 'Review' ? 'bg-purple-100 text-purple-700' :
                      article.type === 'Invited Review' ? 'bg-purple-100 text-purple-700' :
                      article.type === 'Systematic Review' ? 'bg-purple-100 text-purple-700' :
                      article.type === 'Editorial' ? 'bg-blue-100 text-blue-700' :
                      article.type === 'Case Report' ? 'bg-amber-100 text-amber-700' :
                      article.type === 'Brief Report' ? 'bg-teal-100 text-teal-700' :
                      article.type === 'Letter to the Editor' ? 'bg-purple-100 text-purple-700' :
                      article.type === 'Image Corner' ? 'bg-indigo-100 text-indigo-700' :
                      'bg-teal-100 text-teal-700';
      var showAheadOfPrintBadge = Boolean(article.aheadOfPrint || sourceContext === 'aip');

      var pubDate = article.published ? new Date(article.published).toLocaleDateString('en-US', {year:'numeric', month:'long', day:'numeric'}) : '';
      var recDate = article.received ? new Date(article.received).toLocaleDateString('en-US', {year:'numeric', month:'long', day:'numeric'}) : '';
      var accDate = article.accepted ? new Date(article.accepted).toLocaleDateString('en-US', {year:'numeric', month:'long', day:'numeric'}) : '';

      // Authors HTML
      var authorsHtml = article.authors.map(function (a, i) {
        var authorAffiliation = String(a.affiliation || '').trim();
        return '<div class="flex items-start gap-3 py-3' + (i < article.authors.length - 1 ? ' border-b border-gray-100' : '') + '">' +
          '<div class="w-10 h-10 rounded-full bg-teal-100 flex items-center justify-center flex-shrink-0"><span class="text-sm font-semibold text-teal-700">' + a.name.charAt(0) + '</span></div>' +
          '<div>' +
            '<div class="font-medium text-gray-900">' + a.name + '</div>' +
            '<div class="text-sm text-gray-500">' + (authorAffiliation || 'Affiliation not listed') + '</div>' +
            (a.orcid ? '<a href="https://orcid.org/' + a.orcid + '" target="_blank" rel="noopener" class="inline-flex items-center gap-1 text-xs text-teal-700 hover:text-teal-700"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 256 256"><path fill="#A6CE39" d="M256,128c0,70.7-57.3,128-128,128C57.3,256,0,198.7,0,128C0,57.3,57.3,0,128,0C198.7,0,256,57.3,256,128z"/><path fill="#fff" d="M86.3,186.2H70.9V79.1h15.4v48.4V186.2z"/><path fill="#fff" d="M108.9,79.1h41.6c39.6,0,57,28.3,57,53.6c0,27.5-21.5,53.6-56.8,53.6h-41.8V79.1z M124.3,172.4h24.5c34.9,0,42.9-26.5,42.9-39.7c0-21.5-13.7-39.7-43.7-39.7h-23.7V172.4z"/><path fill="#fff" d="M88.7,56.8c0,5.5-4.5,10.1-10.1,10.1c-5.6,0-10.1-4.6-10.1-10.1c0-5.6,4.5-10.1,10.1-10.1C84.2,46.7,88.7,51.3,88.7,56.8z"/></svg>' + a.orcid + '</a>' : '') +
          '</div>' +
        '</div>';
      }).join('');

      // Keywords HTML
      var keywordsHtml = (article.keywords || []).map(function (k) {
        return '<span class="inline-block px-3 py-1 bg-gray-100 text-gray-600 text-sm rounded-full">' + k + '</span>';
      }).join(' ');

      // Related articles
      var related = window.ARTICLES.filter(function (a) { return a.id !== article.id && a.type === article.type; }).slice(0, 3);
      var relatedHtml = related.map(function (r) {
        var relatedAuthor = (r.authors && r.authors.length) ? r.authors[0].name : 'Balkan Medical Journal';
        var relatedAuthorSuffix = (r.authors && r.authors.length > 1) ? ' et al.' : '';
        return '<a href="' + buildArticleUrl(r.id) + '" class="block p-3 rounded-lg hover:bg-gray-50 transition-colors">' +
          '<div class="text-sm font-medium text-gray-900 hover:text-teal-700 leading-snug">' + r.title + '</div>' +
          '<div class="text-xs text-gray-400 mt-1">' + relatedAuthor + relatedAuthorSuffix + '</div>' +
        '</a>';
      }).join('');

      // Build tabs HTML
      var tabsHtml = '';
      if (hasFullText && !isNoAbstract && !isCoverPage) {
        // Articles WITH abstract: show 3 tabs
        tabsHtml =
          '<div class="border-b border-gray-200 mb-8">' +
            '<nav class="flex gap-0 -mb-px overflow-x-auto" aria-label="Article sections">' +
              '<button class="article-tab active" data-tab="abstract" type="button">Abstract</button>' +
              '<button class="article-tab" data-tab="fulltext" type="button">Full Text</button>' +
              '<button class="article-tab" data-tab="authors" type="button">Authors &amp; Affiliations</button>' +
            '</nav>' +
          '</div>';
      }

      // Abstract panel content
      var abstractContent = '';
      if (!isCoverPage && !isNoAbstract && (article.abstractHtml || article.abstract)) {
        var cleanedAbstractHtml = stripDuplicateAbstractLabel(article.abstractHtml || '');
        var abstractBody = cleanedAbstractHtml || (
          '<p>' +
          String(article.abstract || '')
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;') +
          '</p>'
        );
        abstractContent = '<div class="text-gray-700 leading-relaxed prose max-w-none">' + abstractBody + '</div>';
      } else if (!isCoverPage && !isNoAbstract) {
        abstractContent = '<p class="text-gray-500 italic font-serif">No abstract available for this article.</p>';
      }

      // Build main content panels
      var panelsHtml = '';

      if (isNoAbstract && hasFullText) {
        // No-abstract types: show full text directly (no tabs)
        panelsHtml =
          '<div id="fulltext-content">' +
            '<div class="text-center py-12 text-gray-400">' +
              '<div class="spinner mx-auto mb-4" style="border-color: rgba(15,118,110,0.2); border-top-color: #0F766E; width:32px; height:32px; border-width:3px;"></div>' +
              '<p>Loading full text...</p>' +
            '</div>' +
          '</div>' +
          (article.keywords && article.keywords.length ? '<section class="mb-8 mt-8"><h2 class="text-xl font-bold text-gray-900 mb-4">Keywords</h2><div class="flex flex-wrap gap-2">' + keywordsHtml + '</div></section>' : '') +
          '<section class="mb-8"><h2 class="text-xl font-bold text-gray-900 mb-4">Authors &amp; Affiliations</h2><div>' + authorsHtml + '</div></section>';
      } else if (hasFullText && !isNoAbstract && !isCoverPage) {
        // Articles WITH abstract + full text: 3 tab panels
        panelsHtml =
          '<div id="panel-abstract" class="article-tab-panel">' +
            (abstractContent ? '<section class="mb-8"><h2 class="text-xl font-bold text-gray-900 mb-4">Abstract</h2>' + abstractContent + '</section>' : '') +
            (article.keywords && article.keywords.length ? '<section class="mb-8"><h2 class="text-xl font-bold text-gray-900 mb-4">Keywords</h2><div class="flex flex-wrap gap-2">' + keywordsHtml + '</div></section>' : '') +
          '</div>' +
          '<div id="panel-fulltext" class="article-tab-panel hidden">' +
            '<div id="fulltext-content">' +
              '<div class="text-center py-12 text-gray-400">' +
                '<div class="spinner mx-auto mb-4" style="border-color: rgba(15,118,110,0.2); border-top-color: #0F766E; width:32px; height:32px; border-width:3px;"></div>' +
                '<p>Loading full text...</p>' +
              '</div>' +
            '</div>' +
          '</div>' +
          '<div id="panel-authors" class="article-tab-panel hidden">' +
            '<section><h2 class="text-xl font-bold text-gray-900 mb-4">Authors &amp; Affiliations</h2><div>' + authorsHtml + '</div></section>' +
          '</div>';
      } else {
        // No full text: just abstract + authors
        panelsHtml =
          '<div id="panel-abstract" class="article-tab-panel">' +
            (abstractContent ? '<section class="mb-8"><h2 class="text-xl font-bold text-gray-900 mb-4">Abstract</h2>' + abstractContent + '</section>' : '') +
            (article.keywords && article.keywords.length ? '<section class="mb-8"><h2 class="text-xl font-bold text-gray-900 mb-4">Keywords</h2><div class="flex flex-wrap gap-2">' + keywordsHtml + '</div></section>' : '') +
            (isCoverPage ? '' : '<section class="mb-8"><h2 class="text-xl font-bold text-gray-900 mb-4">Authors</h2><div>' + authorsHtml + '</div></section>') +
          '</div>';
      }

      // Sidebar TOC (shows for full text articles)
      var tocHtml = canShowTocCard ?
        '<div id="sidebar-toc" class="bg-gray-50 rounded-xl p-6 hidden">' +
          '<h3 class="font-semibold text-gray-900 mb-3">In This Article</h3>' +
          '<nav class="article-toc" id="toc-nav" aria-label="Table of contents"></nav>' +
        '</div>' : '';

      contentEl.innerHTML =
        '<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">' +
          '<div class="grid grid-cols-1 lg:grid-cols-3 gap-10">' +
            // Main Content
            '<div class="lg:col-span-2">' +
              '<div class="mb-4 flex flex-wrap items-center gap-2">' +
                '<span class="badge ' + typeColor + '">' + article.type + '</span>' +
                (showAheadOfPrintBadge ? '<span class="badge bg-orange-100 text-orange-700">Ahead of Print</span>' : '') +
                '<span class="text-sm text-gray-400">Volume ' + article.volume + ', Issue ' + article.issue + ', pp. ' + article.pages + '</span>' +
              '</div>' +
              '<h1 class="text-2xl md:text-3xl font-bold text-gray-900 leading-tight mb-6">' + article.title + '</h1>' +

              // Authors summary
              '<div class="mb-6">' +
                '<p class="text-gray-600">' + article.authors.map(function(a) {
                  var orcidIcon = a.orcid ? ' <a href="https://orcid.org/' + a.orcid + '" target="_blank" rel="noopener" title="ORCID: ' + a.orcid + '" class="inline-flex align-middle"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 256 256" class="inline-block"><path fill="#A6CE39" d="M256,128c0,70.7-57.3,128-128,128C57.3,256,0,198.7,0,128C0,57.3,57.3,0,128,0C198.7,0,256,57.3,256,128z"/><path fill="#fff" d="M86.3,186.2H70.9V79.1h15.4v48.4V186.2z"/><path fill="#fff" d="M108.9,79.1h41.6c39.6,0,57,28.3,57,53.6c0,27.5-21.5,53.6-56.8,53.6h-41.8V79.1z M124.3,172.4h24.5c34.9,0,42.9-26.5,42.9-39.7c0-21.5-13.7-39.7-43.7-39.7h-23.7V172.4z"/><path fill="#fff" d="M88.7,56.8c0,5.5-4.5,10.1-10.1,10.1c-5.6,0-10.1-4.6-10.1-10.1c0-5.6,4.5-10.1,10.1-10.1C84.2,46.7,88.7,51.3,88.7,56.8z"/></svg></a>' : '';
                  return a.name + orcidIcon;
                }).join(', ') + '</p>' +
              '</div>' +

              // DOI & Dates
              (isCoverPage ? '' :
                '<div class="bg-gray-50 rounded-xl p-4 mb-8 flex flex-wrap gap-x-6 gap-y-2 text-sm">' +
                  '<div><span class="text-gray-400">DOI:</span> <a href="https://doi.org/' + article.doi + '" target="_blank" rel="noopener" class="text-teal-700 hover:underline">' + article.doi + '</a></div>' +
                  (recDate ? '<div><span class="text-gray-400">Received:</span> ' + recDate + '</div>' : '') +
                  (accDate ? '<div><span class="text-gray-400">Accepted:</span> ' + accDate + '</div>' : '') +
                  (pubDate ? '<div><span class="text-gray-400">Published:</span> ' + pubDate + '</div>' : '') +
                '</div>'
              ) +

              // Tabs
              tabsHtml +

              // Panels
              panelsHtml +

            '</div>' +

            // Sidebar
            '<div class="lg:col-span-1">' +
              '<div class="lg:sticky lg:top-28 space-y-6">' +
                // TOC (for full text)
                tocHtml +

                // Download PDF card
                '<div class="bg-gray-50 rounded-xl p-6">' +
                  '<h3 class="text-base leading-6 font-semibold text-gray-900 mb-4">Access</h3>' +
                  (pdfHref
                    ? '<a href="' + escapeAttr(pdfHref) + '" target="_blank" rel="noopener" class="w-full flex items-center justify-center gap-2 px-4 py-3 bg-teal-700 text-white font-semibold rounded-lg hover:bg-teal-800 transition-colors mb-3">' +
                        '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>' +
                        'Download PDF' +
                      '</a>'
                    : '<button type="button" disabled class="w-full flex items-center justify-center gap-2 px-4 py-3 bg-gray-300 text-gray-500 font-semibold rounded-lg cursor-not-allowed mb-3">' +
                        '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>' +
                        'PDF unavailable' +
                      '</button>'
                  ) +
                  '<div class="text-center text-sm text-gray-400">Open Access — Free to Read</div>' +
                '</div>' +

                // Impact card (metrics + citation intelligence)
                (isCoverPage ? '' :
                  '<div class="bg-gray-50 rounded-xl p-6">' +
                    '<h3 class="text-base leading-6 font-semibold text-gray-900 mb-4">Impact</h3>' +
                    '<div class="space-y-3">' +
                      '<div class="flex items-center justify-between"><span class="text-sm text-gray-500">Views</span><span class="font-semibold text-gray-900">' + (article.views || 0).toLocaleString() + '</span></div>' +
                      '<div class="flex items-center justify-between"><span class="text-sm text-gray-500">Downloads</span><span class="font-semibold text-gray-900">' + (article.downloads || 0).toLocaleString() + '</span></div>' +
                    '</div>' +
                    '<div class="border-t border-gray-200 mt-4 pt-4">' +
                      '<h4 class="text-base leading-6 font-semibold text-gray-900 mb-3">Citation Intelligence</h4>' +
                      '<div class="flex items-center justify-between mb-1">' +
                        '<span class="text-sm text-gray-500">Citations</span>' +
                        '<span id="metric-citations" class="text-base font-semibold text-gray-900">' + (article.citations || 0) + '</span>' +
                      '</div>' +
                      '<p id="metric-citations-source" class="text-xs text-gray-400 mb-3">Source: OpenAlex</p>' +
                      '<p id="citation-intel-loading" class="text-sm text-gray-500">Loading citation intelligence...</p>' +
                      '<div id="citation-intel-content" class="hidden space-y-4">' +
                        '<button id="citation-intel-toggle" type="button" aria-expanded="false" class="hidden inline-flex items-center gap-2 text-sm font-medium text-teal-700 hover:text-teal-800 transition-colors">' +
                          '<span id="citation-intel-toggle-text">Show details</span>' +
                          '<svg id="citation-intel-toggle-icon" class="w-4 h-4 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9 6 6 6-6"/></svg>' +
                        '</button>' +
                        '<div id="citation-intel-details" class="hidden space-y-4 pt-1">' +
                          '<div>' +
                          '<div class="flex items-center justify-between mb-2">' +
                            '<span class="text-xs font-semibold uppercase tracking-[0.08em] text-gray-600">Citation Trend</span>' +
                            '<span id="citation-trend-range" class="text-xs text-gray-500"></span>' +
                          '</div>' +
                          '<div id="citation-trend-bars" class="flex items-end gap-1 h-14"></div>' +
                        '</div>' +
                        '<div>' +
                          '<div class="text-xs font-semibold uppercase tracking-[0.08em] text-gray-600 mb-2">Top Citing Journals</div>' +
                          '<div id="citation-intel-journals" class="flex flex-wrap gap-2"></div>' +
                        '</div>' +
                        '<div>' +
                          '<div class="text-xs font-semibold uppercase tracking-[0.08em] text-gray-600 mb-2">Top Citing Fields</div>' +
                          '<div id="citation-intel-fields" class="flex flex-wrap gap-2"></div>' +
                        '</div>' +
                        '<div>' +
                          '<div class="text-xs font-semibold uppercase tracking-[0.08em] text-gray-600 mb-2">Top Citing Papers</div>' +
                          '<div id="citation-intel-papers" class="space-y-2.5"></div>' +
                        '</div>' +
                        '<a id="citation-intel-openalex" href="#" target="_blank" rel="noopener" class="inline-flex items-center text-sm font-medium text-teal-700 hover:text-teal-800">View in OpenAlex →</a>' +
                        '</div>' +
                      '</div>' +
                      '<p id="citation-intel-empty" class="hidden text-sm text-gray-500"></p>' +
                    '</div>' +
                  '</div>'
                ) +

                // Attention metrics card
                (isCoverPage ? '' :
                  '<div class="bg-gray-50 rounded-xl p-6">' +
                    '<h3 class="font-semibold text-gray-900 mb-4">Research Attention</h3>' +
                    '<div id="attention-metrics-grid" class="grid grid-cols-2 gap-3">' +
                      '<div id="altmetric-wrapper" class="flex items-center justify-center h-24">' +
                        '<div id="altmetric-badge" class="altmetric-embed" data-badge-type="donut" data-badge-popover="right" data-hide-no-mentions="true" data-link-target="_blank"></div>' +
                      '</div>' +
                      '<div id="plumx-wrapper" class="flex items-center justify-center h-24">' +
                        '<a id="plumx-badge" class="plumx-plum-print-popup inline-block" data-popup="right" data-size="large" data-hide-when-empty="true" data-site="plumx" style="transform:scale(1.1);transform-origin:center;" href="#"></a>' +
                      '</div>' +
                    '</div>' +
                    '<p id="attention-unavailable" class="hidden text-xs text-gray-400 mt-3">Attention metrics are unavailable for this article.</p>' +
                  '</div>'
                ) +

                // Citation tools
                (isCoverPage ? '' :
                  '<div class="bg-gray-50 rounded-xl p-6">' +
                    '<h3 class="font-semibold text-gray-900 mb-4">Cite This Article</h3>' +
                    '<div class="space-y-2" id="citation-tools">' +
                      '<div>' +
                        '<label for="citation-format" class="text-sm text-gray-500 mb-1 block">Format</label>' +
                        '<select id="citation-format" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500">' +
                          '<option value="apa">APA</option>' +
                          '<option value="mla">MLA</option>' +
                          '<option value="vancouver">Vancouver</option>' +
                          '<option value="bibtex">BibTeX</option>' +
                        '</select>' +
                      '</div>' +
                      '<div id="citation-output" class="bg-white border border-gray-200 rounded-lg p-3 text-xs text-gray-700 leading-relaxed max-h-40 overflow-y-auto"></div>' +
                      '<button id="copy-citation-btn" class="w-full flex items-center justify-center gap-2 px-4 py-2 bg-white border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors text-sm">' +
                        '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>' +
                        'Copy Citation' +
                      '</button>' +
                      '<div class="grid grid-cols-2 gap-2 mt-2">' +
                        '<button id="download-ris-btn" class="flex items-center justify-center gap-1 px-3 py-2 bg-white border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors text-xs">' +
                          '<svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>' +
                          'RIS' +
                        '</button>' +
                        '<button id="download-enw-btn" class="flex items-center justify-center gap-1 px-3 py-2 bg-white border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors text-xs">' +
                          '<svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>' +
                          'EndNote' +
                        '</button>' +
                      '</div>' +
                    '</div>' +
                  '</div>'
                ) +

                // Related articles
                (!isCoverPage && relatedHtml ? '<div class="bg-gray-50 rounded-xl p-6"><h3 class="font-semibold text-gray-900 mb-4">Related Articles</h3><div class="space-y-1">' + relatedHtml + '</div></div>' : '') +
              '</div>' +
            '</div>' +
          '</div>' +
        '</div>';

      syncCitationMetric();
      initCitationIntelligence();
      initAttentionWidgets();

      // ── Tab switching logic ──
      if (hasFullText && isNoAbstract) {
        // No-abstract types: load full text immediately
        fullTextLoaded = true;
        loadFullText();
      } else if (hasFullText && !isNoAbstract) {
        // Articles with abstract: tab UI
        var panelAbstract = document.getElementById('panel-abstract');
        var panelFulltext = document.getElementById('panel-fulltext');
        var panelAuthors  = document.getElementById('panel-authors');
        var tocEl = document.getElementById('sidebar-toc');
        var tocNavEl = document.getElementById('toc-nav');
        var tabBtns = Array.prototype.slice.call(document.querySelectorAll('.article-tab'));
        var panelMap = { abstract: panelAbstract, fulltext: panelFulltext, authors: panelAuthors };

        function switchTab(tabName) {
          for (var i = 0; i < tabBtns.length; i++) {
            var btn = tabBtns[i];
            if (btn.getAttribute('data-tab') === tabName) {
              btn.classList.add('active');
            } else {
              btn.classList.remove('active');
            }
          }
          for (var name in panelMap) {
            if (panelMap[name]) {
              if (name === tabName) {
                panelMap[name].classList.remove('hidden');
              } else {
                panelMap[name].classList.add('hidden');
              }
            }
          }
          if (tocEl) {
            if (tabName !== 'fulltext') {
              tocEl.classList.add('hidden');
            } else if (fullTextLoaded && tocNavEl && tocNavEl.children.length > 0) {
              tocEl.classList.remove('hidden');
            } else {
              tocEl.classList.add('hidden');
            }
          }
          if (tabName === 'fulltext' && !fullTextLoaded) {
            fullTextLoaded = true;
            loadFullText();
          }
        }

        for (var i = 0; i < tabBtns.length; i++) {
          (function (btn) {
            btn.addEventListener('click', function () {
              switchTab(btn.getAttribute('data-tab'));
            });
          })(tabBtns[i]);
        }

        // Hash navigation
        var hash = window.location.hash.replace('#', '');
        if (hash === 'fulltext' || hash === 'full-text') {
          switchTab('fulltext');
        } else if (hash === 'authors') {
          switchTab('authors');
        }
      }

      // ── Full text loading ──
      function loadFullText() {
        var tocCard = document.getElementById('sidebar-toc');
        var tocNav = document.getElementById('toc-nav');
        try {
          DataLoader.loadFullText(id).then(function (html) {
            var container = document.getElementById('fulltext-content');
            if (!container) return;

            if (!html) {
              if (tocNav) tocNav.innerHTML = '';
              if (tocCard) tocCard.classList.add('hidden');
              container.innerHTML =
                '<div class="text-center py-12">' +
                  '<p class="text-gray-500">Full text is not yet available for this article.</p>' +
                  '<p class="text-sm text-gray-400 mt-2">Please check back later or download the PDF.</p>' +
                '</div>';
              return;
            }

            var cleanedFullTextHtml = stripAbstractFromFullText(html);
            var probe = document.createElement('div');
            probe.innerHTML = cleanedFullTextHtml;
            var hasContent = probe.textContent.replace(/\s+/g, ' ').trim().length > 0 || !!probe.querySelector('img, table, figure, video, iframe');
            if (!hasContent) {
              if (tocNav) tocNav.innerHTML = '';
              if (tocCard) tocCard.classList.add('hidden');
              container.innerHTML =
                '<div class="text-center py-12">' +
                  '<p class="text-gray-500">Full text body is not available for this article.</p>' +
                  '<p class="text-sm text-gray-400 mt-2">The abstract is available in the Abstract tab.</p>' +
                '</div>';
              return;
            }

            container.innerHTML = '<div class="article-body">' + cleanedFullTextHtml + '</div>';
            buildTOC();
          }).catch(function () {
            var container = document.getElementById('fulltext-content');
            if (tocNav) tocNav.innerHTML = '';
            if (tocCard) tocCard.classList.add('hidden');
            if (container) {
              container.innerHTML =
                '<div class="text-center py-12">' +
                  '<p class="text-gray-500">Could not load full text.</p>' +
                  '<p class="text-sm text-gray-400 mt-2">Try opening this page via a local web server (e.g. Live Server).</p>' +
                '</div>';
            }
          });
        } catch (e) {
          var container = document.getElementById('fulltext-content');
          if (tocNav) tocNav.innerHTML = '';
          if (tocCard) tocCard.classList.add('hidden');
          if (container) {
            container.innerHTML =
              '<div class="text-center py-12">' +
                '<p class="text-gray-500">Could not load full text.</p>' +
                '<p class="text-sm text-gray-400 mt-2">Try opening this page via a local web server (e.g. Live Server).</p>' +
              '</div>';
          }
        }
      }

      // ── Build table of contents from sections ──
      function buildTOC() {
        var tocCard = document.getElementById('sidebar-toc');
        var tocNav = document.getElementById('toc-nav');
        if (!tocNav) return false;
        tocNav.innerHTML = '';

        var body = document.querySelector('.article-body');
        if (!body) {
          if (tocCard) tocCard.classList.add('hidden');
          return false;
        }

        function normalizeLabel(value) {
          return String(value || '').replace(/\s+/g, ' ').trim();
        }

        function slugify(value) {
          var slug = normalizeLabel(value)
            .toLowerCase()
            .replace(/[^a-z0-9\s-]/g, '')
            .replace(/\s+/g, '-')
            .replace(/-+/g, '-')
            .replace(/^-|-$/g, '');
          return slug;
        }

        var usedIds = {};
        var targets = [];

        // Prefer explicit section anchors if the source has them.
        var sections = Array.prototype.slice.call(body.querySelectorAll('section[id]'));
        sections.forEach(function (sec) {
          var heading = sec.querySelector('h2, h3, h4');
          var label = heading ? normalizeLabel(heading.textContent) : '';
          if (!label) return;
          usedIds[sec.id] = true;
          targets.push({ id: sec.id, label: label, node: sec });
        });

        // Fallback: build TOC from headings directly (common in mirrored source HTML).
        if (targets.length === 0) {
          var headings = Array.prototype.slice.call(body.querySelectorAll('h2, h3'));
          headings.forEach(function (heading, idx) {
            var label = normalizeLabel(heading.textContent);
            if (!label) return;
            if (label.toLowerCase().replace(/[:\-]+$/, '') === 'abstract') return;

            var id = heading.id;
            if (!id) {
              var anchorName = '';
              var prev = heading.previousElementSibling;
              var hops = 0;
              while (prev && hops < 6) {
                if (prev.tagName === 'A' && prev.getAttribute('name')) {
                  anchorName = prev.getAttribute('name');
                  break;
                }
                if (/^H[1-6]$/.test(prev.tagName)) break;
                prev = prev.previousElementSibling;
                hops += 1;
              }
              var base = slugify(anchorName || label) || ('section-' + (idx + 1));
              id = base;
              var suffix = 2;
              while (usedIds[id] || (document.getElementById(id) && document.getElementById(id) !== heading)) {
                id = base + '-' + suffix;
                suffix += 1;
              }
              heading.id = id;
            }
            usedIds[id] = true;
            targets.push({ id: id, label: label, node: heading });
          });
        }

        if (targets.length === 0) {
          if (tocCard) tocCard.classList.add('hidden');
          return false;
        }

        var tocLinks = [];
        targets.forEach(function (item) {
          var link = document.createElement('a');
          link.href = '#' + item.id;
          link.textContent = item.label;
          link.addEventListener('click', function (e) {
            e.preventDefault();
            scrollToArticleTarget(item.node);
            tocLinks.forEach(function (l) { l.classList.remove('active'); });
            link.classList.add('active');
          });
          tocNav.appendChild(link);
          tocLinks.push(link);
        });

        // Scroll spy for TOC
        if (tocLinks.length > 0 && 'IntersectionObserver' in window) {
          var observer = new IntersectionObserver(function (entries) {
            entries.forEach(function (entry) {
              if (entry.isIntersecting) {
                var activeId = entry.target.id;
                tocLinks.forEach(function (l) {
                  l.classList.toggle('active', l.getAttribute('href') === '#' + activeId);
                });
              }
            });
          }, { rootMargin: '-80px 0px -60% 0px', threshold: 0 });

          targets.forEach(function (item) { observer.observe(item.node); });
        }
        if (tocCard) {
          var fulltextPanel = document.getElementById('panel-fulltext');
          var fulltextVisible = !fulltextPanel || !fulltextPanel.classList.contains('hidden');
          if (fulltextVisible) tocCard.classList.remove('hidden');
          else tocCard.classList.add('hidden');
        }
        return true;
      }

      // ── Citation tools interactivity ──
      var formatSelect = document.getElementById('citation-format');
      var outputEl = document.getElementById('citation-output');
      var copyBtn = document.getElementById('copy-citation-btn');

      function updateCitation() {
        var fmt = formatSelect.value;
        var text = '';
        if (fmt === 'apa') text = CitationHelper.apa(article);
        else if (fmt === 'mla') text = CitationHelper.mla(article);
        else if (fmt === 'vancouver') text = CitationHelper.vancouver(article);
        else if (fmt === 'bibtex') text = CitationHelper.bibtex(article);
        outputEl.innerHTML = fmt === 'bibtex' ? '<pre class="whitespace-pre-wrap">' + text + '</pre>' : text;
      }

      if (formatSelect) {
        formatSelect.addEventListener('change', updateCitation);
        updateCitation();
      }

      if (copyBtn) {
        copyBtn.addEventListener('click', function () {
          var fmt = formatSelect.value;
          var text = '';
          if (fmt === 'apa') text = CitationHelper.apa(article);
          else if (fmt === 'mla') text = CitationHelper.mla(article);
          else if (fmt === 'vancouver') text = CitationHelper.vancouver(article);
          else if (fmt === 'bibtex') text = CitationHelper.bibtex(article);
          CitationHelper.copyToClipboard(text);
        });
      }

      // RIS download
      var risBtn = document.getElementById('download-ris-btn');
      if (risBtn) {
        risBtn.addEventListener('click', function () {
          var ris = CitationHelper.ris(article);
          var firstAuthorName = (article.authors && article.authors.length) ? article.authors[0].name : 'Balkan Medical Journal';
          var firstAuthor = firstAuthorName.split(' ').pop();
          var year = article.published ? new Date(article.published).getFullYear() : '';
          CitationHelper.downloadFile(ris, firstAuthor + '_' + year + '.ris', 'application/x-research-info-systems');
          if (window.showToast) window.showToast('RIS file downloaded');
        });
      }

      // EndNote download
      var enwBtn = document.getElementById('download-enw-btn');
      if (enwBtn) {
        enwBtn.addEventListener('click', function () {
          var enw = CitationHelper.endnote(article);
          var firstAuthorName = (article.authors && article.authors.length) ? article.authors[0].name : 'Balkan Medical Journal';
          var firstAuthor = firstAuthorName.split(' ').pop();
          var year = article.published ? new Date(article.published).getFullYear() : '';
          CitationHelper.downloadFile(enw, firstAuthor + '_' + year + '.enw', 'application/x-endnote-refer');
          if (window.showToast) window.showToast('EndNote file downloaded');
        });
      }
    })();
  </script>
<script type="application/ld+json">
{"@context":"https://schema.org","@graph":[{"@type":"Organization","name":"Balkan Medical Journal","url":"https://balkanmedicaljournal.org","logo":"https://balkanmedicaljournal.org/images/logo.png","publisher":{"@type":"Organization","name":"Trakya University"},"address":{"@type":"PostalAddress","addressLocality":"Edirne","addressCountry":"TR","streetAddress":"Trakya University Faculty of Medicine, Balkan Yerleşkesi, 22030"}},{"@type":"WebSite","name":"Balkan Medical Journal","url":"https://balkanmedicaljournal.org","potentialAction":{"@type":"SearchAction","target":"https://balkanmedicaljournal.org/search-results.html?q={search_term_string}","query-input":"required name=search_term_string"}}]}
</script>

</body>
</html>
